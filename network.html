                         <style>

.node {
stroke:
    none;
    stroke-width: 1px;
fill:
#00aeef;
}

.link {
stroke:
#5d6263;
stroke-opacity:
    .06;
}

.label {
fill:
#3f403e;
align: center;
font-family: "Sans Serif";
cursor:
    default;
stroke:

#3f403e;
    stroke-width: 0.5;
    font-weight: 300;
    font-size:1.5em;
text-anchor:
    below;
alignment-baseline:
    middle;
    stroke:#3f403e;
}

</style>
<head>
  <!-- Bootstrap core CSS -->
  <link href="src/bootstrap.min.css" rel="stylesheet">
  <link rel="icon"
        type="image/png"
        href="favicon.ico">
        <script src='https://code.jquery.com/jquery-2.1.4.js'></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<title>Constitutionology - Network</title>
</head>

<body>
  <script>
  $(function () {
      $('#example').popover({container:"body",viewport:'body'})
  });
  </script>

  <div class="container">

    <!-- Static navbar -->
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" style="font-size:35px !important; padding: 35px 35px" href="/">Constitutionology</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="network"><img class="media-object" src="png_32/007-network-border.png"
              onmouseover="this.src='png_64/007-network.png';"
              onmouseout="this.src='png_32/007-network-border.png';"></a></li>
            <li><a href="map"><img class="media-object" src="png_32/008-global-border.png"
              onmouseover="this.src='png_64/008-global.png';"
              onmouseout="this.src='png_32/008-global-border.png';"></span></a></li>
            <li ><a href="timeline"><img class="media-object" src="png_32/005-graphic-1-border.png"
              onmouseover="this.src='png_64/005-graphic-1.png';"
              onmouseout="this.src='png_32/005-graphic-1-border.png';"></span></a></li>
            <li><a href="provisions"><img class="media-object" src="png_32/006-graphic-border.png"
              onmouseover="this.src='png_64/006-graphic.png';"
              onmouseout="this.src='png_32/006-graphic-border.png';"
              ></a></li>
            <li><a href="tree"><img class="media-object" src="png_32/004-nature-border.png"
              onmouseover="this.src='png_64/004-nature.png';"
              onmouseout="this.src='png_32/004-nature-border.png';"></span></a></li>
            <li><a href="hierarchy"><img class="media-object" src="png_32/003-business-border.png"
              onmouseover="this.src='png_64/003-business.png';"
              onmouseout="this.src='png_32/003-business-border.png';"
              ></a></li>
            <li><a href="faq"><img class="media-object" src="png_32/002-mark-border.png"
              onmouseover="this.src='png_64/002-mark.png';"
              onmouseout="this.src='png_32/002-mark-border.png';"
              ></a></li>
            <li><a href="about"><img class="media-object" src="png_32/001-about-us-border.png"
              onmouseover="this.src='png_64/001-about-us.png';"
              onmouseout="this.src='png_32/001-about-us-border.png';"
               ></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div><!--/.container-fluid -->
    </nav>

    <div class="well">
      <div class="media">
    <h4>This is a network in which nodes are countries which are connected if the texts of their constitutions are similar. The network forms 4 distinct
      clusters of countries corresponding to the Commonwealth, former Soviet Union, Iberian
      and Francophone countries.
    </h4>
  </div>
</div>
</div>


<script src="https://d3js.org/d3.v3.min.js"></script>
            <script>

            var margin = {top: 20, right: 80, bottom: 60, left: 60}

            var w = window,
                    d = document,
                    e = d.documentElement,
                    g = d.getElementsByTagName('body')[0],
                    width = w.innerWidth || e.clientWidth || g.clientWidth,
                    height = w.innerHeight|| e.clientHeight|| g.clientHeight;

                    width = width - margin.left - margin.right,
                    height = height - margin.top - margin.bottom;


//            var width = 2000,
//                height = 1200;

//                var width = 2100,
//                height = 1300;
                // Goes with charge=-700, linkDistance=350


//var color = d3.scale.category10();
var color = ['#fbb4ae','#b3cde3','#ccebc5','#decbe4'];
//var color = ['#6A89BA','#6FAF7D','#CB6A72','#9185B7']
//var color = d3.scale.ordinal()
//    .domain([0,1,2,3])
//    .range(colorbrewer.RdBu[4]);


var force = d3.layout.force()
            //.alpha(1.5) //decay of movement
            .charge(-200)
            .linkDistance(100)
            .size([width, height]);

setInterval(function(){force.alpha(0.1);},250);
// Keep the graph moving

var svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height)
          .attr("left", 0);

d3.json("data/network.json", function(error, graph) {
    force
    .nodes(graph.nodes)
    .links(graph.links)
    .start();

    var link = svg.selectAll(".link")
               .data(graph.links)
               .enter().append("line")
               .attr("class", "link")
    .style("stroke-width", function(d) {
        return 2*d.weight;
    });

    // Create the groups under svg
    var gnodes = svg.selectAll('g.gnode')
                 .data(graph.nodes)
                 .enter()
                 .append('g')
                 .attr('n',function(d,i){return i;})
                 .attr('_name',function(d,i){return d.id;})
                 .classed('gnode', true)
                 .on("mouseover", mouseover)
                 .on("mouseout", mouseout)
                 .call(force.drag);

    var node = gnodes.append("circle")
               .attr("class", "node")
               .attr("r", function(d) {return 6;})
               .attr("n", 1)
               .style("fill", function(d) { return color[d.type]; })
               ;

    // Append the labels to each group
    var labels = gnodes.append("text")
    .attr("text-anchor", "middle")
    .text(function(d) {
        if(d.degree<0.0){return d.id}
        else
        {return ''};
    })
    .attr("class", "label")
    .attr('n',function(d,i){return i})
    .attr("_name",function(d,i){return d.id})
    .style("fill", function(d) { return 'grey'; })
    .style("stroke-width",0.0)
    .style("stroke","grey");

    // node.append("title")
    // .text(function(d) { return d.id; });

    force.on("tick", function() {
        link.attr("x1", function(d) {
            return d.source.x;
        })
        .attr("y1", function(d) {
            return d.source.y;
        })
        .attr("x2", function(d) {
            return d.target.x;
        })
        .attr("y2", function(d) {
            return d.target.y;
        });

        // Translate the groups
        gnodes.attr("transform", function(d) {
            return 'translate(' + [d.x, d.y] + ')';
        });

        gnodes.attr("cx", function(d) {
            return d.x;
        })
        .attr("cy", function(d) {
            return d.y;
        });
    });


});

function mouseover() {

  var n=this.getAttribute('n');
  var name=this.getAttribute('_name')
  mouseoverN(n,name);
}

function mouseoverN(n,name,callback)
{
  chosen=$("text[n='"+n+"']")[0];

  chosen.textContent=name;


  d3.select(chosen).transition()
  .duration(1350)
  .style("font-size", 30)

    d3.select($(".gnode[n='"+n+"']")[0]).select("circle").transition()
    .duration(1350)
    .attr("r", 30)

    callback(n,name);
    // call mouseout
}

function mouseout() {
  var n=this.getAttribute('n');
  var name=this.getAttribute('_name');


  mouseoutN(n,name);
}

function mouseClearN(n)
{
  toClear=$("text[n='"+n+"']")[0];

  d3.select(toClear).transition()
  .duration(2000)
  .style("font-size", 0)
  .each("end",function(){toClear.textContent='';})



}

function mouseoutN(n,name)
{
  chosen=$("text[n='"+n+"']")[0];

  chosen.textContent=name;

//  console.log(chosen)

  d3.select(chosen).transition()
  .delay(1350)
  .duration(1350)
  .style("font-size", 12)

    d3.select($(".gnode[n='"+n+"']")[0]).select("circle").transition()
    .delay(1350)
    .duration(1350)
    .attr("r", function(d) {return 6;});


}

var pushedLabels = Array();

window.setInterval(function(){
  var i =Math.floor(Math.random()*194);
  name=$(".gnode[n='"+i+"']")[0].getAttribute('_name');

  pushedLabels.push(i);

  if(pushedLabels.length>20)
  {console.log('Length 10');
  var j=pushedLabels.shift()
  console.log('Clearing '+j);
  mouseClearN(j);}
  // Pop old labels

  mouseoverN(i,name,mouseoutN);

}, 3000);

</script>
