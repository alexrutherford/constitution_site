<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        size: 30px;
        shape-rendering: crispEdges;
    }

    .twitter-typeahead {
        width: 100%;
    }

    .tooltip text {
        font-family: sans-serif, helvetica;
    }
    .axis text {
        font-family: sans-serif, helvetica;
        font-size: 30px;
    }

    .x.axis path {
        display: none;
    }

    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 1.5px;
    }
</style>

<head>
    <!-- Bootstrap core CSS -->
    <link href="src/bootstrap.min.css" rel="stylesheet">
    <link rel="icon"
          type="image/png"
          href="favicon.ico">
          <script src='https://code.jquery.com/jquery-2.1.4.js'></script>

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  <title>Constitutionology - Provision Space</title>
</head>

<body>


  <script>

      var margin = {
          top: 20,
          right: 60,
          bottom: 300,
          left: 120
      };


      var w = window,
          d = document,
          e = d.documentElement,
          g = d.getElementsByTagName('body')[0],
          width = w.innerWidth || e.clientWidth || g.clientWidth,
          height = w.innerHeight || e.clientHeight || g.clientHeight;

      width = width - margin.left - margin.right,
          height = height - margin.top - margin.bottom;


  </script>


    <div class="container">

        <!-- Static navbar -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index">Constitutionology</a>
                </div>
                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                      <li><a href="network">Network</a></li>
                      <li><a href="map">Map</a></li>
                      <li ><a href="timeline">Timeline</a></li>
                      <li><a href="provisions">Provisions</a></li>
                      <li><a href="tree">Tree</a></li>
                      <li><a href="hierarchy">Provision Hierarchy</a></li>
                      <li><a href="faq">FAQ</a></li>
                      <li><a href="about">About</a></li>
                    </ul>
                </div>
                <!--/.nav-collapse -->
            </div>
            <!--/.container-fluid -->
        </nav>



    <!-- load the d3.js library -->
    <script src="https://d3js.org/d3.v3.min.js"></script>

    <script>

    var xFunc = function(i) { return i * ((width+0.01)/data.length)};

    d3.csv('data/out_ranks_provisions_no_ties.txt', function(pos2name) {

      console.log(pos2name);

      console.log(pos2name[0]);


      revKeys=pos2name.map(function(d){return +d['n'];});
      // revKeys[1] => label index at rank 1

    d3.tsv('data/provision_adjacency_index.txt', function(data2) {
      //console.log(data2[0]);

    d3.csv("data/names_sorted.txt", function(trans) {
      data=trans.map(function(d)
    {
    return d['name'];
    });

    var json = (function () {
        var json = null;
        $.ajax({
            'async': false,
            'global': false,
            'url': 'data/full_provision_descriptions_.json',
            'dataType': "json",
            'success': function (data) {
                json = data;
            }
        });
        return json;
    })();

    keys=Object.keys(json)
    console.log(json['LEGISL'])

    keys=keys.map(function(d){return d.toLowerCase();})
    values=keys.map(function(d){return json[d.toUpperCase()];})



    var colorScale = d3.scale.linear().domain([0, keys.length]).range(['blue', 'red']);

    var mid=200;

    var highlighted=false;

    // Set the dimensions of the canvas / graph
    var margin = {top: 20, right: 80, bottom: 250, left: 60}

    var drawArcs = function(i)
    {

      for(j=0;j<values.length;j++)
      {
        var lineGenerator = d3.svg.line().interpolate("monotone");

//        d3.select('path')
//	       .attr('d',lineGenerator([[j,60],[j+(j-i)/2,60],[j,60]]));

        var heightFunc = function(i,j){console.log(2.0*mid*(i-j)/values.length); return 2.0*mid*(i-j)/values.length;}

         var lineData=[[xFunc(i),mid],[xFunc(i)+((xFunc(j)-xFunc(i))/2),
           mid+heightFunc(i,j)],[xFunc(j),mid]];

         svg.append("path")
        .attr("d", lineGenerator(lineData))
        .attr("stroke", colorScale(j))
        .attr("stroke-width", 0.2)
        .attr("fill", "none")
        .attr("id", "id"+j);
      }

    }

    var w = window,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            width = w.innerWidth || e.clientWidth || g.clientWidth,
            height = w.innerHeight|| e.clientHeight|| g.clientHeight;

            width = width - margin.left - margin.right,
            height = height - margin.top - margin.bottom;


            function mouseout(d,i) {
                d3.select(this).transition()
                .duration(500)
                .attr("r", 2);
                console.log("mouse out")

                d3.select("#id"+data[i]["name"]).remove();

                //console.log(d3.select("id"+data[i]["name"]));

                for(j=0;j<values.length;j++)
                {
                  d3.select("#id"+j).remove();
                }
            }


            // Adds the svg canvas
            var svg = d3.select("body")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform",
                          "translate(" + margin.left + "," + margin.top + ")");

            var circle = svg.selectAll("circle")
                .data(data.map(function(d){return d["name"]}));

                function mouseover(d,i) {

                    d3.select(this).transition()
                    .duration(350)
                    .attr("r", 10);
                    console.log("Mouse over")
                    console.log("Name: "+data[i]["name"]);
                    console.log("Data: "+data2[i][10])

                    drawArcs(i);

                    desc=(i+1)+" of 234: ";
                    desc=desc + json[data[i].toUpperCase()];

                    svg.append("text").attr({
                      //x: i * ((width+0.01)/data.length),
                      //y: 40,
                      x:margin.left,
                      y:40,
                      id: "id"+data[i]["name"],
                      fill:colorScale(i)
                    })
                    .text(desc);

                }


            var circleEnter = circle.enter().append("circle")
            .on("mouseover", mouseover)
            .on("mouseout", mouseout);

            //var labels = circleEnter.append("text");

            circleEnter.text(function(d,i){return data[i]["name"]});

            circleEnter.attr("cy", mid);
            circleEnter.attr("cx", function(d,i) {return xFunc(i)});
            circleEnter.attr("r", function(d) { return 2});
            circleEnter.attr("name",function(d,i){return data[i]["name"];});
            circleEnter.attr("fill", function(d,i){return colorScale(i)});

    });
  });
});
    </script>

  </div>
  </div>
</div>
